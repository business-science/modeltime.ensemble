<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Iterative Forecasting with Nested Ensembles • modeltime.ensemble</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Iterative Forecasting with Nested Ensembles">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-20GDZ5LL77"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-20GDZ5LL77');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">modeltime.ensemble</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.5.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../articles/getting-started-with-modeltime-ensemble.html">Getting Started</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><h6 class="dropdown-header" data-toc-skip>Getting Started</h6></li>
    <li><a class="dropdown-item" href="../articles/getting-started-with-modeltime-ensemble.html">Getting Started with Modeltime Ensemble</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Forecasting Many Time Series</h6></li>
    <li><a class="dropdown-item" href="../articles/nested-ensembles.html">Nested Forecasting with Ensembles</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced</h6></li>
    <li><a class="dropdown-item" href="../articles/recursive-ensembles.html">Autoregressive Forecasting (Recursive Ensembles)</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-api" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">API</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-api">
<li><h6 class="dropdown-header" data-toc-skip>API Functions</h6></li>
    <li><a class="dropdown-item" href="../reference/index.html"><span class="fa fa-home"></span> Function Reference</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Change History</h6></li>
    <li><a class="dropdown-item" href="../news/index.html">News</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-ecosystem" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Ecosystem</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-ecosystem">
<li><h6 class="dropdown-header" data-toc-skip>Forecast</h6></li>
    <li><a class="external-link dropdown-item" href="https://business-science.github.io/modeltime/">Modeltime (Forecasting)</a></li>
    <li><a class="external-link dropdown-item" href="https://business-science.github.io/timetk/">TimeTK (Time Series Analysis)</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Improve</h6></li>
    <li><a class="dropdown-item" href="https://business-science.github.io/modeltime.ensemble/">Modeltime Ensemble (Blending Forecasts)</a></li>
    <li><a class="external-link dropdown-item" href="https://business-science.github.io/modeltime.resample/">Modeltime Resample (Backtesting)</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Scale</h6></li>
    <li><a class="external-link dropdown-item" href="https://business-science.github.io/modeltime.h2o/">Modeltime H2O (AutoML)</a></li>
    <li><a class="external-link dropdown-item" href="https://business-science.github.io/modeltime.gluonts/">Modeltime GluonTS (Deep Learning)</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-python" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Python</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-python">
<li><h6 class="dropdown-header" data-toc-skip>Forecast</h6></li>
    <li><a class="external-link dropdown-item" href="https://business-science.github.io/pytimetk/">Timetk for Python (Time Series Analysis)</a></li>
  </ul>
</li>
<li class="nav-item"><a class="external-link nav-link" href="https://university.business-science.io/p/ds4b-203-r-high-performance-time-series-forecasting/"><span class="fa fas fa-graduation-cap"></span> Learn</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/business-science/modeltime.ensemble"><span class="fa fab fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Iterative Forecasting with Nested Ensembles</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/business-science/modeltime.ensemble/blob/master/vignettes/nested-ensembles.Rmd" class="external-link"><code>vignettes/nested-ensembles.Rmd</code></a></small>
      <div class="d-none name"><code>nested-ensembles.Rmd</code></div>
    </div>

    
    
<blockquote>
<p>Iteratively forecast with nested modeling</p>
</blockquote>
<p><strong>Why is nested forecasting important?</strong> For starters,
the ability to <em>iteratively forecast</em> time series with many
models that are trained on many individual groups has been a huge
request from students in our <a href="https://university.business-science.io/p/ds4b-203-r-high-performance-time-series-forecasting/" class="external-link">Time
Series Course</a>. Why? Because two methods exist that get results:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Global Modeling:</strong> Best for scalability using a
Global Models and a Panel Data structure. See <a href="https://business-science.github.io/modeltime/articles/modeling-panel-data.html" class="external-link">Forecasting
with Global Models</a>.</p></li>
<li><p><strong>Iterative Forecasting:</strong> Best for accuracy using a
Nested Data Structure. Takes longer than global model (more resources
due to for-loop iteration), but can yield great results.</p></li>
</ol>
<p>We’ve incorporated a new approach called <strong><em>“nested
forecasting”</em></strong> to help perform <em>Iterative
Forecasting</em>.</p>
<div class="section level3">
<h3 id="what-is-nested-forecasting">What is Nested Forecasting?<a class="anchor" aria-label="anchor" href="#what-is-nested-forecasting"></a>
</h3>
<p>The core idea of <strong>nested forecasting</strong> is to convert a
dataset containing <strong>many time series groups</strong> into a
nested data set, then fit <strong>many models</strong> to each of the
nested datasets. The result is an iterative forecasting process that
generates Nested Modeltime Tables with all of the forecast attributes
needed to make decisions.</p>
</div>
<div class="section level3">
<h3 id="what-is-nested-ensembling">What is Nested Ensembling?<a class="anchor" aria-label="anchor" href="#what-is-nested-ensembling"></a>
</h3>
<p><strong>Nested ensembling</strong> applies the concept of ensembling,
which is generally averaging many individual models (called submodels)
to produce a more stable model that sometimes improves over the best
individual model.</p>
<p>We can <strong>apply the ensembling techniques to iterative or nested
forecasting</strong>. In this tutorial, we will show you how to
perform:</p>
<ul>
<li><p>Average Ensembles using <code><a href="../reference/ensemble_nested_average.html">ensemble_nested_average()</a></code>.
These are the simplest models.</p></li>
<li><p>Weighted Ensembles using <code><a href="../reference/ensemble_nested_weighted.html">ensemble_nested_weighted()</a></code>.
These allow the user to provide “loadings” to distribute the weighting
to the top models, which can sometimes improve over the simple average
ensembles.</p></li>
</ul>
<p>Let’s go!</p>
</div>
<div class="section level2">
<h2 id="nested-ensemble-tutorial">Nested Ensemble Tutorial<a class="anchor" aria-label="anchor" href="#nested-ensemble-tutorial"></a>
</h2>
<p>We’ll showcase <strong>nested ensembling</strong> for iterative
forecasting in this short tutorial.</p>
<div class="section level3">
<h3 id="libraries">Libraries<a class="anchor" aria-label="anchor" href="#libraries"></a>
</h3>
<p>Load the following libraries.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org" class="external-link">tidymodels</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/business-science/modeltime" class="external-link">modeltime</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://business-science.github.io/modeltime.ensemble/">modeltime.ensemble</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/business-science/timetk" class="external-link">timetk</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://gt.rstudio.com" class="external-link">gt</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h3>
<p>Read in the Walmart Sales Weekly data (comes with
<code>timetk</code>).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_tbl</span> <span class="op">&lt;-</span> <span class="va">walmart_sales_weekly</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, date <span class="op">=</span> <span class="va">Date</span>, value <span class="op">=</span> <span class="va">Weekly_Sales</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1_1"</span>, <span class="st">"1_3"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data_tbl</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 286 × 3</span></span></span>
<span><span class="co">#&gt;    id    date        value</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1_1   2010-02-05 <span style="text-decoration: underline;">24</span>924.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 1_1   2010-02-12 <span style="text-decoration: underline;">46</span>039.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 1_1   2010-02-19 <span style="text-decoration: underline;">41</span>596.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 1_1   2010-02-26 <span style="text-decoration: underline;">19</span>404.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 1_1   2010-03-05 <span style="text-decoration: underline;">21</span>828.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 1_1   2010-03-12 <span style="text-decoration: underline;">21</span>043.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 1_1   2010-03-19 <span style="text-decoration: underline;">22</span>137.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 1_1   2010-03-26 <span style="text-decoration: underline;">26</span>229.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 1_1   2010-04-02 <span style="text-decoration: underline;">57</span>258.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 1_1   2010-04-09 <span style="text-decoration: underline;">42</span>961.</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 276 more rows</span></span></span></code></pre>
<p>We can get a quick visual of the two time series we will
forecast.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_tbl</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://business-science.github.io/timetk/reference/plot_time_series.html" class="external-link">plot_time_series</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">value</span>, .facet_ncol <span class="op">=</span> <span class="fl">1</span>, .interactive <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="nested-ensembles_files/figure-html/unnamed-chunk-4-1.png" width="95%" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="prepare-the-data-in-nested-format">Prepare the Data in Nested Format<a class="anchor" aria-label="anchor" href="#prepare-the-data-in-nested-format"></a>
</h3>
<p>The most critical stage in <strong>“Nested Forecasting”</strong> is
data preparation, making sure that the input to the nested forecasting
workflow is in the appropriate structure. We’ve included several
functions to help that involve a bit of forethought that can be broken
into 3 steps:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Extending each of the times series:</strong> How far into
the future do you need to predict for each time series? See
<code><a href="https://business-science.github.io/modeltime/reference/prep_nested.html" class="external-link">extend_timeseries()</a></code>.</p></li>
<li><p><strong>Nesting by the grouping variable:</strong> This is where
you create the nested structure. You’ll identify the ID column that
separates each time series, and the number of timestamps to include in
the “.future_data” and optionally “.actual_data”. Typically, you’ll
select the same <code>.length_future</code> as your extension from the
previous step. See <code><a href="https://business-science.github.io/modeltime/reference/prep_nested.html" class="external-link">nest_timeseries()</a></code>.</p></li>
<li><p><strong>Train/Test Set Splitting:</strong> Finally, you’ll take
your <code>.actual_data</code> and convert into train/test splits that
can be used for accuracy and confidence interval estimation. See
<code><a href="https://business-science.github.io/modeltime/reference/prep_nested.html" class="external-link">split_nested_timeseries()</a></code>.</p></li>
</ol>
<p>Here are the 3-steps in action:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nested_data_tbl</span> <span class="op">&lt;-</span> <span class="va">data_tbl</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="co"># Step 1: Extend</span></span>
<span>    <span class="fu"><a href="https://business-science.github.io/modeltime/reference/prep_nested.html" class="external-link">extend_timeseries</a></span><span class="op">(</span></span>
<span>        .id_var        <span class="op">=</span> <span class="va">id</span>,</span>
<span>        .date_var      <span class="op">=</span> <span class="va">date</span>,</span>
<span>        .length_future <span class="op">=</span> <span class="fl">52</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="co"># Step 2: Nest</span></span>
<span>    <span class="fu"><a href="https://business-science.github.io/modeltime/reference/prep_nested.html" class="external-link">nest_timeseries</a></span><span class="op">(</span></span>
<span>        .id_var        <span class="op">=</span> <span class="va">id</span>,</span>
<span>        .length_future <span class="op">=</span> <span class="fl">52</span>,</span>
<span>        .length_actual <span class="op">=</span> <span class="fl">52</span><span class="op">*</span><span class="fl">2</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="co"># Step 3: Split Train/Test</span></span>
<span>    <span class="fu"><a href="https://business-science.github.io/modeltime/reference/prep_nested.html" class="external-link">split_nested_timeseries</a></span><span class="op">(</span></span>
<span>        .length_test <span class="op">=</span> <span class="fl">52</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="va">nested_data_tbl</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 4</span></span></span>
<span><span class="co">#&gt;   id    .actual_data       .future_data      .splits        </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1_1   <span style="color: #949494;">&lt;tibble [104 × 2]&gt;</span> <span style="color: #949494;">&lt;tibble [52 × 2]&gt;</span> <span style="color: #949494;">&lt;split [52|52]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 1_3   <span style="color: #949494;">&lt;tibble [104 × 2]&gt;</span> <span style="color: #949494;">&lt;tibble [52 × 2]&gt;</span> <span style="color: #949494;">&lt;split [52|52]&gt;</span></span></span></code></pre>
</div>
<div class="section level3">
<h3 id="nested-modeltime-workflow">Nested Modeltime Workflow<a class="anchor" aria-label="anchor" href="#nested-modeltime-workflow"></a>
</h3>
<p>Next, we move into the <strong>Nested Modeltime Workflow</strong> now
that nested data has been created. The Nested Modeltime Workflow
includes 3 steps:</p>
<ol style="list-style-type: decimal">
<li>
<p><strong>Modeling Fitting:</strong> This is the training stage
where we fit to <em>training data</em>. The <em>test forecast</em> is
generated from this step.</p>
<ol style="list-style-type: lower-alpha">
<li><p>Create tidymodels workflows.</p></li>
<li><p><code><a href="https://business-science.github.io/modeltime/reference/modeltime_nested_fit.html" class="external-link">modeltime_nested_fit()</a></code>: Used to fit the submodels to
the training data.</p></li>
<li><p><code><a href="../reference/ensemble_nested_average.html">ensemble_nested_average()</a></code> or
<code><a href="../reference/ensemble_nested_weighted.html">ensemble_nested_weighted()</a></code>: Used to make ensembles from the
submodels.</p></li>
</ol>
</li>
<li><p><strong>Model Evaluation and Selection:</strong> This is where we
review model performance and select the best model by minimizing or
maximizing an error metric. See
<code><a href="https://business-science.github.io/modeltime/reference/modeltime_nested_select_best.html" class="external-link">modeltime_nested_select_best()</a></code>.</p></li>
<li><p><strong>Model Refitting:</strong> This is the final fitting stage
where we fit to <em>actual data</em>. The <em>future forecast</em> is
generated from this step. See
<code><a href="https://business-science.github.io/modeltime/reference/modeltime_nested_refit.html" class="external-link">modeltime_nested_refit()</a></code>.</p></li>
</ol>
<div class="section level4">
<h4 id="step-1a-create-tidymodels-workflows">Step 1A: Create Tidymodels Workflows<a class="anchor" aria-label="anchor" href="#step-1a-create-tidymodels-workflows"></a>
</h4>
<p>First, we create <code>tidymodels</code> workflows for the various
models that you intend to create.</p>
<div class="section level5">
<h5 id="prophet">Prophet<a class="anchor" aria-label="anchor" href="#prophet"></a>
</h5>
<p>A common modeling method is prophet, that can be created using
<code><a href="https://business-science.github.io/modeltime/reference/prophet_reg.html" class="external-link">prophet_reg()</a></code>. We’ll create a workflow. Note that we use
the <code>extract_nested_train_split(nested_data_tbl)</code> to help us
build preprocessing features.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rec_prophet</span> <span class="op">&lt;-</span> <span class="fu">recipe</span><span class="op">(</span><span class="va">value</span> <span class="op">~</span> <span class="va">date</span>, <span class="fu"><a href="https://business-science.github.io/modeltime/reference/log_extractors.html" class="external-link">extract_nested_train_split</a></span><span class="op">(</span><span class="va">nested_data_tbl</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">wflw_prophet</span> <span class="op">&lt;-</span> <span class="fu">workflow</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">add_model</span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://business-science.github.io/modeltime/reference/prophet_reg.html" class="external-link">prophet_reg</a></span><span class="op">(</span><span class="st">"regression"</span>, seasonality_yearly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>            <span class="fu">set_engine</span><span class="op">(</span><span class="st">"prophet"</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">add_recipe</span><span class="op">(</span><span class="va">rec_prophet</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="xgboost">XGBoost<a class="anchor" aria-label="anchor" href="#xgboost"></a>
</h5>
<p>Next, we can use a machine learning method that can get good results:
XGBoost. We will add a few extra features in the recipe feature
engineering step to generate features that tend to get better modeling
results. Note that we use the
<code>extract_nested_train_split(nested_data_tbl)</code> to help us
build preprocessing features.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rec_xgb</span> <span class="op">&lt;-</span> <span class="fu">recipe</span><span class="op">(</span><span class="va">value</span> <span class="op">~</span> <span class="va">.</span>, <span class="fu"><a href="https://business-science.github.io/modeltime/reference/log_extractors.html" class="external-link">extract_nested_train_split</a></span><span class="op">(</span><span class="va">nested_data_tbl</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://business-science.github.io/timetk/reference/step_timeseries_signature.html" class="external-link">step_timeseries_signature</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">step_rm</span><span class="op">(</span><span class="va">date</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">step_zv</span><span class="op">(</span><span class="fu">all_predictors</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">step_dummy</span><span class="op">(</span><span class="fu">all_nominal_predictors</span><span class="op">(</span><span class="op">)</span>, one_hot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wflw_xgb</span> <span class="op">&lt;-</span> <span class="fu">workflow</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">add_model</span><span class="op">(</span><span class="fu">boost_tree</span><span class="op">(</span><span class="st">"regression"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">set_engine</span><span class="op">(</span><span class="st">"xgboost"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">add_recipe</span><span class="op">(</span><span class="va">rec_xgb</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level4">
<h4 id="step-1b-nested-modeltime-tables">Step 1B: Nested Modeltime Tables<a class="anchor" aria-label="anchor" href="#step-1b-nested-modeltime-tables"></a>
</h4>
<p>With a couple of modeling workflows in hand, we are now ready to test
them on each of the time series. We start by using the
<code><a href="https://business-science.github.io/modeltime/reference/modeltime_nested_fit.html" class="external-link">modeltime_nested_fit()</a></code> function, which iteratively fits
each model to each of the nested time series train/test “.splits”
column.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nested_modeltime_tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://business-science.github.io/modeltime/reference/modeltime_nested_fit.html" class="external-link">modeltime_nested_fit</a></span><span class="op">(</span></span>
<span>  <span class="co"># Nested data </span></span>
<span>  nested_data <span class="op">=</span> <span class="va">nested_data_tbl</span>,</span>
<span>  </span>
<span>  <span class="co"># Add workflows</span></span>
<span>  <span class="va">wflw_prophet</span>,</span>
<span>  <span class="va">wflw_xgb</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Fitting models on training data... <span style="color: #00BB00;">■■■■■■■■■■■■■■■■                </span>  50% | ETA:…</span></span></code></pre>
<pre><code><span><span class="co">#&gt; Fitting models on training data... <span style="color: #00BB00;">■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■ </span> 100% | ETA:…</span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nested_modeltime_tbl</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; # Nested Modeltime Table</span></span>
<span><span class="co">#&gt; </span></span></code></pre>
<pre><code><span><span class="co">#&gt; <span style="color: #555555;">Trained on: .splits | Forecast Errors: [0] | Conf Method: conformal_default |</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">Conf Interval: 0.95</span></span></span></code></pre>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 5</span></span></span>
<span><span class="co">#&gt;   id    .actual_data       .future_data      .splits         .modeltime_tables </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1_1   <span style="color: #949494;">&lt;tibble [104 × 2]&gt;</span> <span style="color: #949494;">&lt;tibble [52 × 2]&gt;</span> <span style="color: #949494;">&lt;split [52|52]&gt;</span> <span style="color: #949494;">&lt;mdl_tm_t [2 × 5]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 1_3   <span style="color: #949494;">&lt;tibble [104 × 2]&gt;</span> <span style="color: #949494;">&lt;tibble [52 × 2]&gt;</span> <span style="color: #949494;">&lt;split [52|52]&gt;</span> <span style="color: #949494;">&lt;mdl_tm_t [2 × 5]&gt;</span></span></span></code></pre>
<p>This adds a new column with <code>.modeltime_tables</code> for each
of the data sets and has created several <strong>logged
attributes</strong> that are part of the “Nested Modeltime Table”. We
also can see that the models were trained on “.splits” and none of the
models had any errors.</p>
<div class="section level5">
<h5 id="accuracy-check">Accuracy Check<a class="anchor" aria-label="anchor" href="#accuracy-check"></a>
</h5>
<p>This is kind of advanced, but because our accuracy functions
(<code>table_modeltime_accuracy(.interactive = FALSE)</code>) produce
static <code>gt</code> table, we can make a function to highlight rows
by group.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tab_style_by_group</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">...</span>, <span class="va">style</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">subset_log</span> <span class="op">&lt;-</span> <span class="va">object</span><span class="op">[[</span><span class="st">"_boxhead"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"type"</span><span class="op">]</span><span class="op">]</span><span class="op">==</span><span class="st">"row_group"</span></span>
<span>  <span class="va">grp_col</span>    <span class="op">&lt;-</span> <span class="va">object</span><span class="op">[[</span><span class="st">"_boxhead"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"var"</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">subset_log</span><span class="op">]</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/sym.html" class="external-link">sym</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">object</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://gt.rstudio.com/reference/tab_style.html" class="external-link">tab_style</a></span><span class="op">(</span></span>
<span>      style <span class="op">=</span> <span class="va">style</span>,</span>
<span>      locations <span class="op">=</span> <span class="fu"><a href="https://gt.rstudio.com/reference/cells_body.html" class="external-link">cells_body</a></span><span class="op">(</span></span>
<span>        rows <span class="op">=</span> <span class="va">.</span><span class="op">[[</span><span class="st">"_data"</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>          <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rowid_to_column</a></span><span class="op">(</span><span class="st">"rowid"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>          <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="va">grp_col</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>          <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>          <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>          <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">rowid</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>And now we can see which models are the winners, performing the best
by group with the lowest RMSE (root mean squared error).</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nested_modeltime_tbl</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://business-science.github.io/modeltime/reference/log_extractors.html" class="external-link">extract_nested_test_accuracy</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://business-science.github.io/modeltime/reference/table_modeltime_accuracy.html" class="external-link">table_modeltime_accuracy</a></span><span class="op">(</span>.interactive <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">tab_style_by_group</span><span class="op">(</span></span>
<span>    <span class="va">rmse</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">rmse</span><span class="op">)</span>,</span>
<span>    style <span class="op">=</span> <span class="fu"><a href="https://gt.rstudio.com/reference/cell_fill.html" class="external-link">cell_fill</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div id="jcdmfnbyes" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#jcdmfnbyes table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#jcdmfnbyes thead, #jcdmfnbyes tbody, #jcdmfnbyes tfoot, #jcdmfnbyes tr, #jcdmfnbyes td, #jcdmfnbyes th {
  border-style: none;
}

#jcdmfnbyes p {
  margin: 0;
  padding: 0;
}

#jcdmfnbyes .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#jcdmfnbyes .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#jcdmfnbyes .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#jcdmfnbyes .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#jcdmfnbyes .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#jcdmfnbyes .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#jcdmfnbyes .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#jcdmfnbyes .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#jcdmfnbyes .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#jcdmfnbyes .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#jcdmfnbyes .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#jcdmfnbyes .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#jcdmfnbyes .gt_spanner_row {
  border-bottom-style: hidden;
}

#jcdmfnbyes .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#jcdmfnbyes .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#jcdmfnbyes .gt_from_md > :first-child {
  margin-top: 0;
}

#jcdmfnbyes .gt_from_md > :last-child {
  margin-bottom: 0;
}

#jcdmfnbyes .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#jcdmfnbyes .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#jcdmfnbyes .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#jcdmfnbyes .gt_row_group_first td {
  border-top-width: 2px;
}

#jcdmfnbyes .gt_row_group_first th {
  border-top-width: 2px;
}

#jcdmfnbyes .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#jcdmfnbyes .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#jcdmfnbyes .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#jcdmfnbyes .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#jcdmfnbyes .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#jcdmfnbyes .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#jcdmfnbyes .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#jcdmfnbyes .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#jcdmfnbyes .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#jcdmfnbyes .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#jcdmfnbyes .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#jcdmfnbyes .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#jcdmfnbyes .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#jcdmfnbyes .gt_left {
  text-align: left;
}

#jcdmfnbyes .gt_center {
  text-align: center;
}

#jcdmfnbyes .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#jcdmfnbyes .gt_font_normal {
  font-weight: normal;
}

#jcdmfnbyes .gt_font_bold {
  font-weight: bold;
}

#jcdmfnbyes .gt_font_italic {
  font-style: italic;
}

#jcdmfnbyes .gt_super {
  font-size: 65%;
}

#jcdmfnbyes .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#jcdmfnbyes .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#jcdmfnbyes .gt_indent_1 {
  text-indent: 5px;
}

#jcdmfnbyes .gt_indent_2 {
  text-indent: 10px;
}

#jcdmfnbyes .gt_indent_3 {
  text-indent: 15px;
}

#jcdmfnbyes .gt_indent_4 {
  text-indent: 20px;
}

#jcdmfnbyes .gt_indent_5 {
  text-indent: 25px;
}

#jcdmfnbyes .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#jcdmfnbyes div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="table gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_heading">
<td colspan="9" class="gt_heading gt_title gt_font_normal gt_bottom_border" style>Accuracy Table</td>
    </tr>
<tr class="gt_col_headings">
<th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="a.model_id">.model_id</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="a.model_desc">.model_desc</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="a.type">.type</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="mae">mae</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="mape">mape</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="mase">mase</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="smape">smape</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="rmse">rmse</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="rsq">rsq</th>
    </tr>
</thead>
<tbody class="gt_table_body">
<tr class="gt_group_heading_row">
<th colspan="9" class="gt_group_heading" scope="colgroup" id="1_1">1_1</th>
    </tr>
<tr class="gt_row_group_first">
<td headers="1_1  .model_id" class="gt_row gt_right">1</td>
<td headers="1_1  .model_desc" class="gt_row gt_left">PROPHET</td>
<td headers="1_1  .type" class="gt_row gt_left">Test</td>
<td headers="1_1  mae" class="gt_row gt_right">10071.47</td>
<td headers="1_1  mape" class="gt_row gt_right">45.88</td>
<td headers="1_1  mase" class="gt_row gt_right">1.99</td>
<td headers="1_1  smape" class="gt_row gt_right">59.97</td>
<td headers="1_1  rmse" class="gt_row gt_right">11776.87</td>
<td headers="1_1  rsq" class="gt_row gt_right">0.38</td>
</tr>
<tr>
<td headers="1_1  .model_id" class="gt_row gt_right" style="background-color: #ADD8E6;">2</td>
<td headers="1_1  .model_desc" class="gt_row gt_left" style="background-color: #ADD8E6;">XGBOOST</td>
<td headers="1_1  .type" class="gt_row gt_left" style="background-color: #ADD8E6;">Test</td>
<td headers="1_1  mae" class="gt_row gt_right" style="background-color: #ADD8E6;">6223.73</td>
<td headers="1_1  mape" class="gt_row gt_right" style="background-color: #ADD8E6;">25.25</td>
<td headers="1_1  mase" class="gt_row gt_right" style="background-color: #ADD8E6;">1.23</td>
<td headers="1_1  smape" class="gt_row gt_right" style="background-color: #ADD8E6;">24.50</td>
<td headers="1_1  rmse" class="gt_row gt_right" style="background-color: #ADD8E6;">9026.26</td>
<td headers="1_1  rsq" class="gt_row gt_right" style="background-color: #ADD8E6;">0.19</td>
</tr>
<tr class="gt_group_heading_row">
<th colspan="9" class="gt_group_heading" scope="colgroup" id="1_3">1_3</th>
    </tr>
<tr class="gt_row_group_first">
<td headers="1_3  .model_id" class="gt_row gt_right" style="background-color: #ADD8E6;">1</td>
<td headers="1_3  .model_desc" class="gt_row gt_left" style="background-color: #ADD8E6;">PROPHET</td>
<td headers="1_3  .type" class="gt_row gt_left" style="background-color: #ADD8E6;">Test</td>
<td headers="1_3  mae" class="gt_row gt_right" style="background-color: #ADD8E6;">3539.80</td>
<td headers="1_3  mape" class="gt_row gt_right" style="background-color: #ADD8E6;">29.87</td>
<td headers="1_3  mase" class="gt_row gt_right" style="background-color: #ADD8E6;">1.37</td>
<td headers="1_3  smape" class="gt_row gt_right" style="background-color: #ADD8E6;">25.46</td>
<td headers="1_3  rmse" class="gt_row gt_right" style="background-color: #ADD8E6;">4707.77</td>
<td headers="1_3  rsq" class="gt_row gt_right" style="background-color: #ADD8E6;">0.80</td>
</tr>
<tr>
<td headers="1_3  .model_id" class="gt_row gt_right">2</td>
<td headers="1_3  .model_desc" class="gt_row gt_left">XGBOOST</td>
<td headers="1_3  .type" class="gt_row gt_left">Test</td>
<td headers="1_3  mae" class="gt_row gt_right">3071.25</td>
<td headers="1_3  mape" class="gt_row gt_right">18.74</td>
<td headers="1_3  mase" class="gt_row gt_right">1.19</td>
<td headers="1_3  smape" class="gt_row gt_right">20.26</td>
<td headers="1_3  rmse" class="gt_row gt_right">5069.27</td>
<td headers="1_3  rsq" class="gt_row gt_right">0.79</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="section level4">
<h4 id="step-1c-make-ensembles">Step 1C: Make Ensembles<a class="anchor" aria-label="anchor" href="#step-1c-make-ensembles"></a>
</h4>
<p>Now that we’ve fitted submodels, our goal is to <strong>improve on
the submodels by leveraging ensembles.</strong></p>
<div class="section level5">
<h5 id="average-ensemble">Average Ensemble<a class="anchor" aria-label="anchor" href="#average-ensemble"></a>
</h5>
<p>We’ll give a go at an <strong>average ensemble</strong> using a
simple mean with the <code><a href="../reference/ensemble_nested_average.html">ensemble_nested_average()</a></code> function. We
select <code>type = "mean"</code> for simple average (another option is
median ensemble, which is better when you have models with large
spikes).</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nested_ensemble_1_tbl</span> <span class="op">&lt;-</span> <span class="va">nested_modeltime_tbl</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/ensemble_nested_average.html">ensemble_nested_average</a></span><span class="op">(</span></span>
<span>        type           <span class="op">=</span> <span class="st">"mean"</span>, </span>
<span>        keep_submodels <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="va">nested_ensemble_1_tbl</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; # Nested Modeltime Table</span></span>
<span><span class="co">#&gt; </span></span></code></pre>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 5</span></span></span>
<span><span class="co">#&gt;   id    .actual_data       .future_data      .splits         .modeltime_tables </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1_1   <span style="color: #949494;">&lt;tibble [104 × 2]&gt;</span> <span style="color: #949494;">&lt;tibble [52 × 2]&gt;</span> <span style="color: #949494;">&lt;split [52|52]&gt;</span> <span style="color: #949494;">&lt;mdl_tm_t [3 × 5]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 1_3   <span style="color: #949494;">&lt;tibble [104 × 2]&gt;</span> <span style="color: #949494;">&lt;tibble [52 × 2]&gt;</span> <span style="color: #949494;">&lt;split [52|52]&gt;</span> <span style="color: #949494;">&lt;mdl_tm_t [3 × 5]&gt;</span></span></span></code></pre>
<p>We can check the accuracy again. This time the Ensemble (MEAN)
outperforms both the prophet and xgboost submodels.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nested_ensemble_1_tbl</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://business-science.github.io/modeltime/reference/log_extractors.html" class="external-link">extract_nested_test_accuracy</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://business-science.github.io/modeltime/reference/table_modeltime_accuracy.html" class="external-link">table_modeltime_accuracy</a></span><span class="op">(</span>.interactive <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">tab_style_by_group</span><span class="op">(</span></span>
<span>    <span class="va">rmse</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">rmse</span><span class="op">)</span>,</span>
<span>    style <span class="op">=</span> <span class="fu"><a href="https://gt.rstudio.com/reference/cell_fill.html" class="external-link">cell_fill</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div id="rejldsxtyq" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#rejldsxtyq table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#rejldsxtyq thead, #rejldsxtyq tbody, #rejldsxtyq tfoot, #rejldsxtyq tr, #rejldsxtyq td, #rejldsxtyq th {
  border-style: none;
}

#rejldsxtyq p {
  margin: 0;
  padding: 0;
}

#rejldsxtyq .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#rejldsxtyq .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#rejldsxtyq .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#rejldsxtyq .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#rejldsxtyq .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rejldsxtyq .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rejldsxtyq .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rejldsxtyq .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#rejldsxtyq .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#rejldsxtyq .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#rejldsxtyq .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#rejldsxtyq .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#rejldsxtyq .gt_spanner_row {
  border-bottom-style: hidden;
}

#rejldsxtyq .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#rejldsxtyq .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#rejldsxtyq .gt_from_md > :first-child {
  margin-top: 0;
}

#rejldsxtyq .gt_from_md > :last-child {
  margin-bottom: 0;
}

#rejldsxtyq .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#rejldsxtyq .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#rejldsxtyq .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#rejldsxtyq .gt_row_group_first td {
  border-top-width: 2px;
}

#rejldsxtyq .gt_row_group_first th {
  border-top-width: 2px;
}

#rejldsxtyq .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rejldsxtyq .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#rejldsxtyq .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#rejldsxtyq .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rejldsxtyq .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rejldsxtyq .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#rejldsxtyq .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#rejldsxtyq .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#rejldsxtyq .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rejldsxtyq .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rejldsxtyq .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#rejldsxtyq .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rejldsxtyq .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#rejldsxtyq .gt_left {
  text-align: left;
}

#rejldsxtyq .gt_center {
  text-align: center;
}

#rejldsxtyq .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#rejldsxtyq .gt_font_normal {
  font-weight: normal;
}

#rejldsxtyq .gt_font_bold {
  font-weight: bold;
}

#rejldsxtyq .gt_font_italic {
  font-style: italic;
}

#rejldsxtyq .gt_super {
  font-size: 65%;
}

#rejldsxtyq .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#rejldsxtyq .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#rejldsxtyq .gt_indent_1 {
  text-indent: 5px;
}

#rejldsxtyq .gt_indent_2 {
  text-indent: 10px;
}

#rejldsxtyq .gt_indent_3 {
  text-indent: 15px;
}

#rejldsxtyq .gt_indent_4 {
  text-indent: 20px;
}

#rejldsxtyq .gt_indent_5 {
  text-indent: 25px;
}

#rejldsxtyq .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#rejldsxtyq div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="table gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_heading">
<td colspan="9" class="gt_heading gt_title gt_font_normal gt_bottom_border" style>Accuracy Table</td>
    </tr>
<tr class="gt_col_headings">
<th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="a.model_id">.model_id</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="a.model_desc">.model_desc</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="a.type">.type</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="mae">mae</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="mape">mape</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="mase">mase</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="smape">smape</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="rmse">rmse</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="rsq">rsq</th>
    </tr>
</thead>
<tbody class="gt_table_body">
<tr class="gt_group_heading_row">
<th colspan="9" class="gt_group_heading" scope="colgroup" id="1_1">1_1</th>
    </tr>
<tr class="gt_row_group_first">
<td headers="1_1  .model_id" class="gt_row gt_right">1</td>
<td headers="1_1  .model_desc" class="gt_row gt_left">PROPHET</td>
<td headers="1_1  .type" class="gt_row gt_left">Test</td>
<td headers="1_1  mae" class="gt_row gt_right">10071.47</td>
<td headers="1_1  mape" class="gt_row gt_right">45.88</td>
<td headers="1_1  mase" class="gt_row gt_right">1.99</td>
<td headers="1_1  smape" class="gt_row gt_right">59.97</td>
<td headers="1_1  rmse" class="gt_row gt_right">11776.87</td>
<td headers="1_1  rsq" class="gt_row gt_right">0.38</td>
</tr>
<tr>
<td headers="1_1  .model_id" class="gt_row gt_right">2</td>
<td headers="1_1  .model_desc" class="gt_row gt_left">XGBOOST</td>
<td headers="1_1  .type" class="gt_row gt_left">Test</td>
<td headers="1_1  mae" class="gt_row gt_right">6223.73</td>
<td headers="1_1  mape" class="gt_row gt_right">25.25</td>
<td headers="1_1  mase" class="gt_row gt_right">1.23</td>
<td headers="1_1  smape" class="gt_row gt_right">24.50</td>
<td headers="1_1  rmse" class="gt_row gt_right">9026.26</td>
<td headers="1_1  rsq" class="gt_row gt_right">0.19</td>
</tr>
<tr>
<td headers="1_1  .model_id" class="gt_row gt_right" style="background-color: #ADD8E6;">3</td>
<td headers="1_1  .model_desc" class="gt_row gt_left" style="background-color: #ADD8E6;">ENSEMBLE (MEAN): 2 MODELS</td>
<td headers="1_1  .type" class="gt_row gt_left" style="background-color: #ADD8E6;">Test</td>
<td headers="1_1  mae" class="gt_row gt_right" style="background-color: #ADD8E6;">5411.95</td>
<td headers="1_1  mape" class="gt_row gt_right" style="background-color: #ADD8E6;">20.18</td>
<td headers="1_1  mase" class="gt_row gt_right" style="background-color: #ADD8E6;">1.07</td>
<td headers="1_1  smape" class="gt_row gt_right" style="background-color: #ADD8E6;">22.20</td>
<td headers="1_1  rmse" class="gt_row gt_right" style="background-color: #ADD8E6;">8654.09</td>
<td headers="1_1  rsq" class="gt_row gt_right" style="background-color: #ADD8E6;">0.41</td>
</tr>
<tr class="gt_group_heading_row">
<th colspan="9" class="gt_group_heading" scope="colgroup" id="1_3">1_3</th>
    </tr>
<tr class="gt_row_group_first">
<td headers="1_3  .model_id" class="gt_row gt_right">1</td>
<td headers="1_3  .model_desc" class="gt_row gt_left">PROPHET</td>
<td headers="1_3  .type" class="gt_row gt_left">Test</td>
<td headers="1_3  mae" class="gt_row gt_right">3539.80</td>
<td headers="1_3  mape" class="gt_row gt_right">29.87</td>
<td headers="1_3  mase" class="gt_row gt_right">1.37</td>
<td headers="1_3  smape" class="gt_row gt_right">25.46</td>
<td headers="1_3  rmse" class="gt_row gt_right">4707.77</td>
<td headers="1_3  rsq" class="gt_row gt_right">0.80</td>
</tr>
<tr>
<td headers="1_3  .model_id" class="gt_row gt_right">2</td>
<td headers="1_3  .model_desc" class="gt_row gt_left">XGBOOST</td>
<td headers="1_3  .type" class="gt_row gt_left">Test</td>
<td headers="1_3  mae" class="gt_row gt_right">3071.25</td>
<td headers="1_3  mape" class="gt_row gt_right">18.74</td>
<td headers="1_3  mase" class="gt_row gt_right">1.19</td>
<td headers="1_3  smape" class="gt_row gt_right">20.26</td>
<td headers="1_3  rmse" class="gt_row gt_right">5069.27</td>
<td headers="1_3  rsq" class="gt_row gt_right">0.79</td>
</tr>
<tr>
<td headers="1_3  .model_id" class="gt_row gt_right" style="background-color: #ADD8E6;">3</td>
<td headers="1_3  .model_desc" class="gt_row gt_left" style="background-color: #ADD8E6;">ENSEMBLE (MEAN): 2 MODELS</td>
<td headers="1_3  .type" class="gt_row gt_left" style="background-color: #ADD8E6;">Test</td>
<td headers="1_3  mae" class="gt_row gt_right" style="background-color: #ADD8E6;">2659.68</td>
<td headers="1_3  mape" class="gt_row gt_right" style="background-color: #ADD8E6;">18.99</td>
<td headers="1_3  mase" class="gt_row gt_right" style="background-color: #ADD8E6;">1.03</td>
<td headers="1_3  smape" class="gt_row gt_right" style="background-color: #ADD8E6;">17.74</td>
<td headers="1_3  rmse" class="gt_row gt_right" style="background-color: #ADD8E6;">4037.20</td>
<td headers="1_3  rsq" class="gt_row gt_right" style="background-color: #ADD8E6;">0.82</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level5">
<h5 id="weighted-ensemble">Weighted Ensemble<a class="anchor" aria-label="anchor" href="#weighted-ensemble"></a>
</h5>
<p>Next, we can give a go at a weighted ensemble with the
<code><a href="../reference/ensemble_nested_weighted.html">ensemble_nested_weighted()</a></code> function. A few key points about
the arguments:</p>
<ul>
<li><p><code>loadings</code>: This parameter allows us to weight models
differently. Providing <code>c(2,1)</code> places a 2-to-1 weighting on
the two submodels.</p></li>
<li><p><code>metric</code>: This parameter is determined by the
<strong>accuracy table.</strong> The default is to use the “rmse”
column. The loadings are then applied to the best (lowest) “rmse” first.
The best model will have 2/3 (66% weight) loading and the second best
will have 1/3 (33% weight).</p></li>
<li><p><code>model_ids</code>: This is a filtering mechanism to help us
isolate which model ID’s that we want to include as submodels. We want
to exclude Model ID 3, because this is our Ensemble Average (MEAN)
model.</p></li>
<li><p><code>control</code>: This uses <code><a href="https://business-science.github.io/modeltime/reference/control_modeltime.html" class="external-link">control_nested_fit()</a></code>
to control aspects of the fitting process like running in Parallel vs
Sequential and outputting verbose to provide additional information
during the fitting process.</p></li>
</ul>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nested_ensemble_2_tbl</span> <span class="op">&lt;-</span> <span class="va">nested_ensemble_1_tbl</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/ensemble_nested_weighted.html">ensemble_nested_weighted</a></span><span class="op">(</span></span>
<span>        loadings        <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>,  </span>
<span>        metric          <span class="op">=</span> <span class="st">"rmse"</span>,</span>
<span>        model_ids       <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, </span>
<span>        control         <span class="op">=</span> <span class="fu"><a href="https://business-science.github.io/modeltime/reference/control_modeltime.html" class="external-link">control_nested_fit</a></span><span class="op">(</span>allow_par <span class="op">=</span> <span class="cn">FALSE</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="op">)</span> </span></code></pre></div>
<pre><code><span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> [1/2] Starting Modeltime Table: ID 1_1...</span></span></code></pre>
<pre><code><span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Model 4 Passed ENSEMBLE WEIGHTED.</span></span></code></pre>
<pre><code><span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> [1/2] Finished Modeltime Table: ID 1_1</span></span></code></pre>
<pre><code><span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> [2/2] Starting Modeltime Table: ID 1_3...</span></span></code></pre>
<pre><code><span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Model 4 Passed ENSEMBLE WEIGHTED.</span></span></code></pre>
<pre><code><span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> [2/2] Finished Modeltime Table: ID 1_3</span></span></code></pre>
<pre><code><span><span class="co">#&gt; Finished in: 1.287128 secs.</span></span></code></pre>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nested_ensemble_2_tbl</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; # Nested Modeltime Table</span></span>
<span><span class="co">#&gt; </span></span></code></pre>
<pre><code><span><span class="co">#&gt; <span style="color: #555555;">Trained on: .splits | Forecast Errors: [0] | Conf Method: conformal_default |</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">Conf Interval: 0.95</span></span></span></code></pre>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 5</span></span></span>
<span><span class="co">#&gt;   id    .actual_data       .future_data      .splits         .modeltime_tables </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1_1   <span style="color: #949494;">&lt;tibble [104 × 2]&gt;</span> <span style="color: #949494;">&lt;tibble [52 × 2]&gt;</span> <span style="color: #949494;">&lt;split [52|52]&gt;</span> <span style="color: #949494;">&lt;mdl_tm_t [4 × 5]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 1_3   <span style="color: #949494;">&lt;tibble [104 × 2]&gt;</span> <span style="color: #949494;">&lt;tibble [52 × 2]&gt;</span> <span style="color: #949494;">&lt;split [52|52]&gt;</span> <span style="color: #949494;">&lt;mdl_tm_t [4 × 5]&gt;</span></span></span></code></pre>
<p>Next, let’s check the accuracy on the new ensemble. The Weighted
Ensemble has improved the 1_1 time series, but not the 1_3 time
series.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nested_ensemble_2_tbl</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://business-science.github.io/modeltime/reference/log_extractors.html" class="external-link">extract_nested_test_accuracy</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://business-science.github.io/modeltime/reference/table_modeltime_accuracy.html" class="external-link">table_modeltime_accuracy</a></span><span class="op">(</span>.interactive <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">tab_style_by_group</span><span class="op">(</span></span>
<span>    <span class="va">rmse</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">rmse</span><span class="op">)</span>,</span>
<span>    style <span class="op">=</span> <span class="fu"><a href="https://gt.rstudio.com/reference/cell_fill.html" class="external-link">cell_fill</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div id="wtxjxwiyji" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#wtxjxwiyji table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#wtxjxwiyji thead, #wtxjxwiyji tbody, #wtxjxwiyji tfoot, #wtxjxwiyji tr, #wtxjxwiyji td, #wtxjxwiyji th {
  border-style: none;
}

#wtxjxwiyji p {
  margin: 0;
  padding: 0;
}

#wtxjxwiyji .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#wtxjxwiyji .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#wtxjxwiyji .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#wtxjxwiyji .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#wtxjxwiyji .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wtxjxwiyji .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wtxjxwiyji .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wtxjxwiyji .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#wtxjxwiyji .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#wtxjxwiyji .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#wtxjxwiyji .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#wtxjxwiyji .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#wtxjxwiyji .gt_spanner_row {
  border-bottom-style: hidden;
}

#wtxjxwiyji .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#wtxjxwiyji .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#wtxjxwiyji .gt_from_md > :first-child {
  margin-top: 0;
}

#wtxjxwiyji .gt_from_md > :last-child {
  margin-bottom: 0;
}

#wtxjxwiyji .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#wtxjxwiyji .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#wtxjxwiyji .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#wtxjxwiyji .gt_row_group_first td {
  border-top-width: 2px;
}

#wtxjxwiyji .gt_row_group_first th {
  border-top-width: 2px;
}

#wtxjxwiyji .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wtxjxwiyji .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#wtxjxwiyji .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#wtxjxwiyji .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wtxjxwiyji .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wtxjxwiyji .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#wtxjxwiyji .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#wtxjxwiyji .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#wtxjxwiyji .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wtxjxwiyji .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wtxjxwiyji .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#wtxjxwiyji .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wtxjxwiyji .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#wtxjxwiyji .gt_left {
  text-align: left;
}

#wtxjxwiyji .gt_center {
  text-align: center;
}

#wtxjxwiyji .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#wtxjxwiyji .gt_font_normal {
  font-weight: normal;
}

#wtxjxwiyji .gt_font_bold {
  font-weight: bold;
}

#wtxjxwiyji .gt_font_italic {
  font-style: italic;
}

#wtxjxwiyji .gt_super {
  font-size: 65%;
}

#wtxjxwiyji .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#wtxjxwiyji .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#wtxjxwiyji .gt_indent_1 {
  text-indent: 5px;
}

#wtxjxwiyji .gt_indent_2 {
  text-indent: 10px;
}

#wtxjxwiyji .gt_indent_3 {
  text-indent: 15px;
}

#wtxjxwiyji .gt_indent_4 {
  text-indent: 20px;
}

#wtxjxwiyji .gt_indent_5 {
  text-indent: 25px;
}

#wtxjxwiyji .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#wtxjxwiyji div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="table gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_heading">
<td colspan="9" class="gt_heading gt_title gt_font_normal gt_bottom_border" style>Accuracy Table</td>
    </tr>
<tr class="gt_col_headings">
<th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="a.model_id">.model_id</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="a.model_desc">.model_desc</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="a.type">.type</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="mae">mae</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="mape">mape</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="mase">mase</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="smape">smape</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="rmse">rmse</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="rsq">rsq</th>
    </tr>
</thead>
<tbody class="gt_table_body">
<tr class="gt_group_heading_row">
<th colspan="9" class="gt_group_heading" scope="colgroup" id="1_1">1_1</th>
    </tr>
<tr class="gt_row_group_first">
<td headers="1_1  .model_id" class="gt_row gt_right">1</td>
<td headers="1_1  .model_desc" class="gt_row gt_left">PROPHET</td>
<td headers="1_1  .type" class="gt_row gt_left">Test</td>
<td headers="1_1  mae" class="gt_row gt_right">10071.47</td>
<td headers="1_1  mape" class="gt_row gt_right">45.88</td>
<td headers="1_1  mase" class="gt_row gt_right">1.99</td>
<td headers="1_1  smape" class="gt_row gt_right">59.97</td>
<td headers="1_1  rmse" class="gt_row gt_right">11776.87</td>
<td headers="1_1  rsq" class="gt_row gt_right">0.38</td>
</tr>
<tr>
<td headers="1_1  .model_id" class="gt_row gt_right">2</td>
<td headers="1_1  .model_desc" class="gt_row gt_left">XGBOOST</td>
<td headers="1_1  .type" class="gt_row gt_left">Test</td>
<td headers="1_1  mae" class="gt_row gt_right">6223.73</td>
<td headers="1_1  mape" class="gt_row gt_right">25.25</td>
<td headers="1_1  mase" class="gt_row gt_right">1.23</td>
<td headers="1_1  smape" class="gt_row gt_right">24.50</td>
<td headers="1_1  rmse" class="gt_row gt_right">9026.26</td>
<td headers="1_1  rsq" class="gt_row gt_right">0.19</td>
</tr>
<tr>
<td headers="1_1  .model_id" class="gt_row gt_right">3</td>
<td headers="1_1  .model_desc" class="gt_row gt_left">ENSEMBLE (MEAN): 2 MODELS</td>
<td headers="1_1  .type" class="gt_row gt_left">Test</td>
<td headers="1_1  mae" class="gt_row gt_right">5411.95</td>
<td headers="1_1  mape" class="gt_row gt_right">20.18</td>
<td headers="1_1  mase" class="gt_row gt_right">1.07</td>
<td headers="1_1  smape" class="gt_row gt_right">22.20</td>
<td headers="1_1  rmse" class="gt_row gt_right">8654.09</td>
<td headers="1_1  rsq" class="gt_row gt_right">0.41</td>
</tr>
<tr>
<td headers="1_1  .model_id" class="gt_row gt_right" style="background-color: #ADD8E6;">4</td>
<td headers="1_1  .model_desc" class="gt_row gt_left" style="background-color: #ADD8E6;">ENSEMBLE (WEIGHTED): 2 MODELS</td>
<td headers="1_1  .type" class="gt_row gt_left" style="background-color: #ADD8E6;">Test</td>
<td headers="1_1  mae" class="gt_row gt_right" style="background-color: #ADD8E6;">4398.23</td>
<td headers="1_1  mape" class="gt_row gt_right" style="background-color: #ADD8E6;">14.67</td>
<td headers="1_1  mase" class="gt_row gt_right" style="background-color: #ADD8E6;">0.87</td>
<td headers="1_1  smape" class="gt_row gt_right" style="background-color: #ADD8E6;">15.90</td>
<td headers="1_1  rmse" class="gt_row gt_right" style="background-color: #ADD8E6;">8322.65</td>
<td headers="1_1  rsq" class="gt_row gt_right" style="background-color: #ADD8E6;">0.41</td>
</tr>
<tr class="gt_group_heading_row">
<th colspan="9" class="gt_group_heading" scope="colgroup" id="1_3">1_3</th>
    </tr>
<tr class="gt_row_group_first">
<td headers="1_3  .model_id" class="gt_row gt_right">1</td>
<td headers="1_3  .model_desc" class="gt_row gt_left">PROPHET</td>
<td headers="1_3  .type" class="gt_row gt_left">Test</td>
<td headers="1_3  mae" class="gt_row gt_right">3539.80</td>
<td headers="1_3  mape" class="gt_row gt_right">29.87</td>
<td headers="1_3  mase" class="gt_row gt_right">1.37</td>
<td headers="1_3  smape" class="gt_row gt_right">25.46</td>
<td headers="1_3  rmse" class="gt_row gt_right">4707.77</td>
<td headers="1_3  rsq" class="gt_row gt_right">0.80</td>
</tr>
<tr>
<td headers="1_3  .model_id" class="gt_row gt_right">2</td>
<td headers="1_3  .model_desc" class="gt_row gt_left">XGBOOST</td>
<td headers="1_3  .type" class="gt_row gt_left">Test</td>
<td headers="1_3  mae" class="gt_row gt_right">3071.25</td>
<td headers="1_3  mape" class="gt_row gt_right">18.74</td>
<td headers="1_3  mase" class="gt_row gt_right">1.19</td>
<td headers="1_3  smape" class="gt_row gt_right">20.26</td>
<td headers="1_3  rmse" class="gt_row gt_right">5069.27</td>
<td headers="1_3  rsq" class="gt_row gt_right">0.79</td>
</tr>
<tr>
<td headers="1_3  .model_id" class="gt_row gt_right" style="background-color: #ADD8E6;">3</td>
<td headers="1_3  .model_desc" class="gt_row gt_left" style="background-color: #ADD8E6;">ENSEMBLE (MEAN): 2 MODELS</td>
<td headers="1_3  .type" class="gt_row gt_left" style="background-color: #ADD8E6;">Test</td>
<td headers="1_3  mae" class="gt_row gt_right" style="background-color: #ADD8E6;">2659.68</td>
<td headers="1_3  mape" class="gt_row gt_right" style="background-color: #ADD8E6;">18.99</td>
<td headers="1_3  mase" class="gt_row gt_right" style="background-color: #ADD8E6;">1.03</td>
<td headers="1_3  smape" class="gt_row gt_right" style="background-color: #ADD8E6;">17.74</td>
<td headers="1_3  rmse" class="gt_row gt_right" style="background-color: #ADD8E6;">4037.20</td>
<td headers="1_3  rsq" class="gt_row gt_right" style="background-color: #ADD8E6;">0.82</td>
</tr>
<tr>
<td headers="1_3  .model_id" class="gt_row gt_right">4</td>
<td headers="1_3  .model_desc" class="gt_row gt_left">ENSEMBLE (WEIGHTED): 2 MODELS</td>
<td headers="1_3  .type" class="gt_row gt_left">Test</td>
<td headers="1_3  mae" class="gt_row gt_right">2776.66</td>
<td headers="1_3  mape" class="gt_row gt_right">21.31</td>
<td headers="1_3  mase" class="gt_row gt_right">1.08</td>
<td headers="1_3  smape" class="gt_row gt_right">19.17</td>
<td headers="1_3  rmse" class="gt_row gt_right">4069.13</td>
<td headers="1_3  rsq" class="gt_row gt_right">0.82</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="section level4">
<h4 id="step-2-select-best">Step 2: Select Best<a class="anchor" aria-label="anchor" href="#step-2-select-best"></a>
</h4>
<p>Using the accuracy data, we can pick a metric and select the best
model based on that metric. The available metrics are in the
<code><a href="https://business-science.github.io/modeltime/reference/metric_sets.html" class="external-link">default_forecast_accuracy_metric_set()</a></code>. Make sure to select
<code>minimize</code> based on the metric. The
<code>filter_test_forecasts</code> parameter tells the function to
filter the logged test forecasts to just the best.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">best_nested_modeltime_tbl</span> <span class="op">&lt;-</span> <span class="va">nested_ensemble_2_tbl</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://business-science.github.io/modeltime/reference/modeltime_nested_select_best.html" class="external-link">modeltime_nested_select_best</a></span><span class="op">(</span></span>
<span>      metric                <span class="op">=</span> <span class="st">"rmse"</span>, </span>
<span>      minimize              <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>      filter_test_forecasts <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<div class="section level5">
<h5 id="extract-nested-best-model-report">Extract Nested Best Model Report<a class="anchor" aria-label="anchor" href="#extract-nested-best-model-report"></a>
</h5>
<p>The best model selections can be accessed with
<code><a href="https://business-science.github.io/modeltime/reference/log_extractors.html" class="external-link">extract_nested_best_model_report()</a></code>.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">best_nested_modeltime_tbl</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://business-science.github.io/modeltime/reference/log_extractors.html" class="external-link">extract_nested_best_model_report</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://business-science.github.io/modeltime/reference/table_modeltime_accuracy.html" class="external-link">table_modeltime_accuracy</a></span><span class="op">(</span>.interactive <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div id="sysoqoweyt" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#sysoqoweyt table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#sysoqoweyt thead, #sysoqoweyt tbody, #sysoqoweyt tfoot, #sysoqoweyt tr, #sysoqoweyt td, #sysoqoweyt th {
  border-style: none;
}

#sysoqoweyt p {
  margin: 0;
  padding: 0;
}

#sysoqoweyt .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#sysoqoweyt .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#sysoqoweyt .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#sysoqoweyt .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#sysoqoweyt .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#sysoqoweyt .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#sysoqoweyt .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#sysoqoweyt .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#sysoqoweyt .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#sysoqoweyt .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#sysoqoweyt .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#sysoqoweyt .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#sysoqoweyt .gt_spanner_row {
  border-bottom-style: hidden;
}

#sysoqoweyt .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#sysoqoweyt .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#sysoqoweyt .gt_from_md > :first-child {
  margin-top: 0;
}

#sysoqoweyt .gt_from_md > :last-child {
  margin-bottom: 0;
}

#sysoqoweyt .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#sysoqoweyt .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#sysoqoweyt .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#sysoqoweyt .gt_row_group_first td {
  border-top-width: 2px;
}

#sysoqoweyt .gt_row_group_first th {
  border-top-width: 2px;
}

#sysoqoweyt .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#sysoqoweyt .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#sysoqoweyt .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#sysoqoweyt .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#sysoqoweyt .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#sysoqoweyt .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#sysoqoweyt .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#sysoqoweyt .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#sysoqoweyt .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#sysoqoweyt .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#sysoqoweyt .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#sysoqoweyt .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#sysoqoweyt .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#sysoqoweyt .gt_left {
  text-align: left;
}

#sysoqoweyt .gt_center {
  text-align: center;
}

#sysoqoweyt .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#sysoqoweyt .gt_font_normal {
  font-weight: normal;
}

#sysoqoweyt .gt_font_bold {
  font-weight: bold;
}

#sysoqoweyt .gt_font_italic {
  font-style: italic;
}

#sysoqoweyt .gt_super {
  font-size: 65%;
}

#sysoqoweyt .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#sysoqoweyt .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#sysoqoweyt .gt_indent_1 {
  text-indent: 5px;
}

#sysoqoweyt .gt_indent_2 {
  text-indent: 10px;
}

#sysoqoweyt .gt_indent_3 {
  text-indent: 15px;
}

#sysoqoweyt .gt_indent_4 {
  text-indent: 20px;
}

#sysoqoweyt .gt_indent_5 {
  text-indent: 25px;
}

#sysoqoweyt .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#sysoqoweyt div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="table gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_heading">
<td colspan="10" class="gt_heading gt_title gt_font_normal gt_bottom_border" style>Accuracy Table</td>
    </tr>
<tr class="gt_col_headings">
<th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="id">id</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="a.model_id">.model_id</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="a.model_desc">.model_desc</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="a.type">.type</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="mae">mae</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="mape">mape</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="mase">mase</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="smape">smape</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="rmse">rmse</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="rsq">rsq</th>
    </tr>
</thead>
<tbody class="gt_table_body">
<tr>
<td headers="id" class="gt_row gt_center">1_1</td>
<td headers=".model_id" class="gt_row gt_right">4</td>
<td headers=".model_desc" class="gt_row gt_left">ENSEMBLE (WEIGHTED): 2 MODELS</td>
<td headers=".type" class="gt_row gt_left">Test</td>
<td headers="mae" class="gt_row gt_right">4398.23</td>
<td headers="mape" class="gt_row gt_right">14.67</td>
<td headers="mase" class="gt_row gt_right">0.87</td>
<td headers="smape" class="gt_row gt_right">15.90</td>
<td headers="rmse" class="gt_row gt_right">8322.65</td>
<td headers="rsq" class="gt_row gt_right">0.41</td>
</tr>
<tr>
<td headers="id" class="gt_row gt_center">1_3</td>
<td headers=".model_id" class="gt_row gt_right">3</td>
<td headers=".model_desc" class="gt_row gt_left">ENSEMBLE (MEAN): 2 MODELS</td>
<td headers=".type" class="gt_row gt_left">Test</td>
<td headers="mae" class="gt_row gt_right">2659.68</td>
<td headers="mape" class="gt_row gt_right">18.99</td>
<td headers="mase" class="gt_row gt_right">1.03</td>
<td headers="smape" class="gt_row gt_right">17.74</td>
<td headers="rmse" class="gt_row gt_right">4037.20</td>
<td headers="rsq" class="gt_row gt_right">0.82</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level5">
<h5 id="extract-nested-best-test-forecasts">Extract Nested Best Test Forecasts<a class="anchor" aria-label="anchor" href="#extract-nested-best-test-forecasts"></a>
</h5>
<p>Once we’ve selected the best models, we can easily visualize the best
forecasts by time series. Note that the nested test forecast logs have
been modified to isolate the best models.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">best_nested_modeltime_tbl</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://business-science.github.io/modeltime/reference/log_extractors.html" class="external-link">extract_nested_test_forecast</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://business-science.github.io/modeltime/reference/plot_modeltime_forecast.html" class="external-link">plot_modeltime_forecast</a></span><span class="op">(</span></span>
<span>    .facet_ncol  <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    .interactive <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="nested-ensembles_files/figure-html/unnamed-chunk-17-1.png" width="95%" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level4">
<h4 id="step-3-refitting-and-future-forecast">Step 3: Refitting and Future Forecast<a class="anchor" aria-label="anchor" href="#step-3-refitting-and-future-forecast"></a>
</h4>
<p>With the best models in hand, we can make our future forecasts by
refitting the models to the full dataset.</p>
<ul>
<li><p>If the best models have been selected, the only the best models
will be refit.</p></li>
<li><p>If best models have not been selected, then all models will be
refit.</p></li>
</ul>
<p>We’ve selected our best models, and will move forward with refitting
and future forecast logging using the
<code><a href="https://business-science.github.io/modeltime/reference/modeltime_nested_refit.html" class="external-link">modeltime_nested_refit()</a></code> function.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nested_modeltime_refit_tbl</span> <span class="op">&lt;-</span> <span class="va">best_nested_modeltime_tbl</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://business-science.github.io/modeltime/reference/modeltime_nested_refit.html" class="external-link">modeltime_nested_refit</a></span><span class="op">(</span></span>
<span>        control <span class="op">=</span> <span class="fu"><a href="https://business-science.github.io/modeltime/reference/control_modeltime.html" class="external-link">control_nested_refit</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> [1/2] Starting Modeltime Table: ID 1_1...</span></span></code></pre>
<pre><code><span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Model 4 Passed ENSEMBLE (WEIGHTED): 2 MODELS.</span></span></code></pre>
<pre><code><span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> [1/2] Finished Modeltime Table: ID 1_1</span></span></code></pre>
<pre><code><span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> [2/2] Starting Modeltime Table: ID 1_3...</span></span></code></pre>
<pre><code><span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Model 3 Passed ENSEMBLE (MEAN): 2 MODELS.</span></span></code></pre>
<pre><code><span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> [2/2] Finished Modeltime Table: ID 1_3</span></span></code></pre>
<pre><code><span><span class="co">#&gt; Finished in: 0.9537709 secs.</span></span></code></pre>
<p>We can see that the nested modeltime table appears the same, but has
now been trained on <code>.actual_data</code>.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nested_modeltime_refit_tbl</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; # Nested Modeltime Table</span></span>
<span><span class="co">#&gt; </span></span></code></pre>
<pre><code><span><span class="co">#&gt; <span style="color: #555555;">Trained on: .actual_data | Forecast Errors: [0] | Conf Method:</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">conformal_default | Conf Interval: 0.95</span></span></span></code></pre>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 5</span></span></span>
<span><span class="co">#&gt;   id    .actual_data       .future_data      .splits         .modeltime_tables </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1_1   <span style="color: #949494;">&lt;tibble [104 × 2]&gt;</span> <span style="color: #949494;">&lt;tibble [52 × 2]&gt;</span> <span style="color: #949494;">&lt;split [52|52]&gt;</span> <span style="color: #949494;">&lt;mdl_tm_t [1 × 5]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 1_3   <span style="color: #949494;">&lt;tibble [104 × 2]&gt;</span> <span style="color: #949494;">&lt;tibble [52 × 2]&gt;</span> <span style="color: #949494;">&lt;split [52|52]&gt;</span> <span style="color: #949494;">&lt;mdl_tm_t [1 × 5]&gt;</span></span></span></code></pre>
<div class="section level5">
<h5 id="extract-nested-future-forecast">Extract Nested Future Forecast<a class="anchor" aria-label="anchor" href="#extract-nested-future-forecast"></a>
</h5>
<p>After the refitting process completes, we can now access the future
forecast, which is logged.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nested_modeltime_refit_tbl</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://business-science.github.io/modeltime/reference/log_extractors.html" class="external-link">extract_nested_future_forecast</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://business-science.github.io/modeltime/reference/plot_modeltime_forecast.html" class="external-link">plot_modeltime_forecast</a></span><span class="op">(</span></span>
<span>    .interactive <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    .facet_ncol  <span class="op">=</span> <span class="fl">2</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="nested-ensembles_files/figure-html/unnamed-chunk-20-1.png" width="95%" style="display: block; margin: auto;"></p>
</div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>Nested ensembling is a powerful technique that can improve
forecasting accuracy. But, this is just a small portion of what can be
done to take your forecasting to the next level… If you want to
<strong>become a forecasting expert for your organization</strong>, then
take the read on!</p>
<div class="section level3">
<h3 id="take-the-high-performance-forecasting-course">Take the High-Performance Forecasting Course<a class="anchor" aria-label="anchor" href="#take-the-high-performance-forecasting-course"></a>
</h3>
<blockquote>
<p>Become the forecasting expert for your organization</p>
</blockquote>
<p><a href="https://university.business-science.io/p/ds4b-203-r-high-performance-time-series-forecasting/" target="_blank" class="external-link"><img src="https://www.filepicker.io/api/file/bKyqVAi5Qi64sS05QYLk" alt="High-Performance Time Series Forecasting Course" width="100%" style="box-shadow: 0 0 5px 2px rgba(0, 0, 0, .5);"></a></p>
<p><a href="https://university.business-science.io/p/ds4b-203-r-high-performance-time-series-forecasting/" class="external-link"><em>High-Performance
Time Series Course</em></a></p>
<div class="section level4">
<h4 id="time-series-is-changing">Time Series is Changing<a class="anchor" aria-label="anchor" href="#time-series-is-changing"></a>
</h4>
<p>Time series is changing. <strong>Businesses now need 10,000+ time
series forecasts every day.</strong> This is what I call a
<em>High-Performance Time Series Forecasting System (HPTSF)</em> -
Accurate, Robust, and Scalable Forecasting.</p>
<p><strong>High-Performance Forecasting Systems will save companies by
improving accuracy and scalability.</strong> Imagine what will happen to
your career if you can provide your organization a “High-Performance
Time Series Forecasting System” (HPTSF System).</p>
</div>
<div class="section level4">
<h4 id="how-to-learn-high-performance-time-series-forecasting">How to Learn High-Performance Time Series Forecasting<a class="anchor" aria-label="anchor" href="#how-to-learn-high-performance-time-series-forecasting"></a>
</h4>
<p>I teach how to build a HPTFS System in my <a href="https://university.business-science.io/p/ds4b-203-r-high-performance-time-series-forecasting" class="external-link"><strong>High-Performance
Time Series Forecasting Course</strong></a>. You will learn:</p>
<ul>
<li>
<strong>Time Series Machine Learning</strong> (cutting-edge) with
<code>Modeltime</code> - 30+ Models (Prophet, ARIMA, XGBoost, Random
Forest, &amp; many more)</li>
<li>
<strong>Deep Learning</strong> with <code>GluonTS</code>
(Competition Winners)</li>
<li>
<strong>Time Series Preprocessing</strong>, Noise Reduction, &amp;
Anomaly Detection</li>
<li>
<strong>Feature engineering</strong> using lagged variables &amp;
external regressors</li>
<li><strong>Hyperparameter Tuning</strong></li>
<li><strong>Time series cross-validation</strong></li>
<li>
<strong>Ensembling</strong> Multiple Machine Learning &amp;
Univariate Modeling Techniques (Competition Winner)</li>
<li>
<strong>Scalable Forecasting</strong> - Forecast 1000+ time series
in parallel</li>
<li>and more.</li>
</ul>
<p class="text-center" style="font-size:24px;">
</p>
<p>Become the Time Series Expert for your organization.</p>

<p><br></p>
<p class="text-center" style="font-size:30px;">
</p>
<p><a href="https://university.business-science.io/p/ds4b-203-r-high-performance-time-series-forecasting" class="external-link">Take
the High-Performance Time Series Forecasting Course</a></p>

</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Matt Dancho.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
