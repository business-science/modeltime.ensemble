<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="modeltime.ensemble">
<title>Autoregressive Forecasting (Recursive Ensembles) • modeltime.ensemble</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Autoregressive Forecasting (Recursive Ensembles)">
<meta property="og:description" content="modeltime.ensemble">
<meta property="og:image" content="https://business-science.github.io/modeltime.ensemble/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-20GDZ5LL77"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-20GDZ5LL77');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">modeltime.ensemble</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.3.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/getting-started-with-modeltime-ensemble.html">Getting Started</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Getting Started</h6>
    <a class="dropdown-item" href="../articles/getting-started-with-modeltime-ensemble.html">Getting Started with Modeltime Ensemble</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Forecasting Many Time Series</h6>
    <a class="dropdown-item" href="../articles/nested-ensembles.html">Nested Forecasting with Ensembles</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Advanced</h6>
    <a class="dropdown-item" href="../articles/recursive-ensembles.html">Autoregressive Forecasting (Recursive Ensembles)</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-api">API</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-api">
    <h6 class="dropdown-header" data-toc-skip>API Functions</h6>
    <a class="dropdown-item" href="../reference/index.html">
      <span class="fa fa-home"></span>
       
      Function Reference
    </a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Change History</h6>
    <a class="dropdown-item" href="../news/index.html">News</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-ecosystem">Ecosystem</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-ecosystem">
    <h6 class="dropdown-header" data-toc-skip>Forecast</h6>
    <a class="external-link dropdown-item" href="https://business-science.github.io/modeltime/">Modeltime (Forecasting)</a>
    <a class="external-link dropdown-item" href="https://business-science.github.io/timetk/">TimeTK (Time Series Analysis)</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Improve</h6>
    <a class="dropdown-item" href="https://business-science.github.io/modeltime.ensemble/">Modeltime Ensemble (Blending Forecasts)</a>
    <a class="external-link dropdown-item" href="https://business-science.github.io/modeltime.resample/">Modeltime Resample (Backtesting)</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Scale</h6>
    <a class="external-link dropdown-item" href="https://business-science.github.io/modeltime.h2o/">Modeltime H2O (AutoML)</a>
    <a class="external-link dropdown-item" href="https://business-science.github.io/modeltime.gluonts/">Modeltime GluonTS (Deep Learning)</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-python">Python</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-python">
    <h6 class="dropdown-header" data-toc-skip>Forecast</h6>
    <a class="external-link dropdown-item" href="https://business-science.github.io/pytimetk/">Timetk for Python (Time Series Analysis)</a>
  </div>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://university.business-science.io/p/ds4b-203-r-high-performance-time-series-forecasting/">
    <span class="fas fa fas fa-graduation-cap"></span>
     
    Learn
  </a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/business-science/modeltime.ensemble">
    <span class="fab fa fab fa-github"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Autoregressive Forecasting (Recursive Ensembles)</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/business-science/modeltime.ensemble/blob/master/vignettes/recursive-ensembles.Rmd" class="external-link"><code>vignettes/recursive-ensembles.Rmd</code></a></small>
      <div class="d-none name"><code>recursive-ensembles.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="what-is-a-recursive-model">What is a Recursive Model?<a class="anchor" aria-label="anchor" href="#what-is-a-recursive-model"></a>
</h2>
<p>A <strong><em>recursive model</em></strong> uses predictions to
generate new values for independent features. These features are
typically lags used in <strong>autoregressive models.</strong></p>
</div>
<div class="section level2">
<h2 id="why-is-recursive-needed-for-autoregressive-models">Why is Recursive needed for Autoregressive Models?<a class="anchor" aria-label="anchor" href="#why-is-recursive-needed-for-autoregressive-models"></a>
</h2>
<p>It’s important to understand that a recursive model is only needed
when using lagged features with a <strong>Lag Size &lt; Forecast
Horizon.</strong> When the lag length is less than the forecast horizon,
a problem exists were missing values (<code>NA</code>) are generated in
the future data.</p>
<p>A solution that <code><a href="https://business-science.github.io/modeltime/reference/recursive.html" class="external-link">recursive()</a></code> implements is to iteratively
fill these missing values in with values generated from predictions.
This technique can be used for:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Single ensemble recursive predictions</strong> -
Effectively turning any <code>ensemble</code> model into an
Autoregressive (AR) model</p></li>
<li><p><strong>Panel ensemble recursive predictions</strong> - In many
situations we need to forecast <strong>more than one time
series</strong>. We can batch-process these with 1 model by processing
time series groups as panels. This technique can be extended to
recursive forecasting for scalable models (1 model that predicts many
time series).</p></li>
</ol>
<p>Here’s an example of a panel forecast that uses a recursive ensemble
with Elastic Net and XGBoost models.</p>
<p><img src="panel-ensemble.png" width="95%" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="single-ensemble-recursive-example">Single Ensemble Recursive Example<a class="anchor" aria-label="anchor" href="#single-ensemble-recursive-example"></a>
</h2>
<blockquote>
<p>Use single ensembles to forecast a single time series</p>
</blockquote>
<p>First, we need to load the necessary libraries:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://business-science.github.io/modeltime.ensemble/">modeltime.ensemble</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/business-science/modeltime" class="external-link">modeltime</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org" class="external-link">tidymodels</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://glmnet.stanford.edu" class="external-link">glmnet</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dmlc/xgboost" class="external-link">xgboost</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/business-science/timetk" class="external-link">timetk</a></span><span class="op">)</span></span></code></pre></div>
<p>Next, we select a forecast horizon of 24 days and extend the data
frame with the function <code><a href="https://rdrr.io/pkg/timetk/man/future_frame.html" class="external-link">future_frame()</a></code>. We do this to
create a future dataset, which we can distinguish because its values
will be NA.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">FORECAST_HORIZON</span> <span class="op">&lt;-</span> <span class="fl">24</span></span>
<span></span>
<span><span class="va">m750_extended</span> <span class="op">&lt;-</span> <span class="va">m750</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/timetk/man/future_frame.html" class="external-link">future_frame</a></span><span class="op">(</span></span>
<span>        .length_out <span class="op">=</span> <span class="va">FORECAST_HORIZON</span>,</span>
<span>        .bind_data  <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>The next step is to create a <strong><em>Transformer
Function</em></strong> where we create the lagged variables that our
model will use. Notice that we create lags up to our forecast horizon.
We could also include rolling features and any number of other
“engineered features” based on lags.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lag_transformer</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/timetk/man/tk_augment_lags.html" class="external-link">tk_augment_lags</a></span><span class="op">(</span><span class="va">value</span>, .lags <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">FORECAST_HORIZON</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Data Preparation</span></span>
<span><span class="va">m750_lagged</span> <span class="op">&lt;-</span> <span class="va">m750_extended</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">lag_transformer</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">m750_lagged</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 330 × 27</span></span></span>
<span><span class="co">#&gt;    id    date       value value_lag1 value_lag2 value_lag3 value_lag4 value_lag5</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> M750  1990-01-01  <span style="text-decoration: underline;">6</span>370         <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> M750  1990-02-01  <span style="text-decoration: underline;">6</span>430       <span style="text-decoration: underline;">6</span>370         <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> M750  1990-03-01  <span style="text-decoration: underline;">6</span>520       <span style="text-decoration: underline;">6</span>430       <span style="text-decoration: underline;">6</span>370         <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> M750  1990-04-01  <span style="text-decoration: underline;">6</span>580       <span style="text-decoration: underline;">6</span>520       <span style="text-decoration: underline;">6</span>430       <span style="text-decoration: underline;">6</span>370         <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> M750  1990-05-01  <span style="text-decoration: underline;">6</span>620       <span style="text-decoration: underline;">6</span>580       <span style="text-decoration: underline;">6</span>520       <span style="text-decoration: underline;">6</span>430       <span style="text-decoration: underline;">6</span>370         <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> M750  1990-06-01  <span style="text-decoration: underline;">6</span>690       <span style="text-decoration: underline;">6</span>620       <span style="text-decoration: underline;">6</span>580       <span style="text-decoration: underline;">6</span>520       <span style="text-decoration: underline;">6</span>430       <span style="text-decoration: underline;">6</span>370</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> M750  1990-07-01  <span style="text-decoration: underline;">6</span>000       <span style="text-decoration: underline;">6</span>690       <span style="text-decoration: underline;">6</span>620       <span style="text-decoration: underline;">6</span>580       <span style="text-decoration: underline;">6</span>520       <span style="text-decoration: underline;">6</span>430</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> M750  1990-08-01  <span style="text-decoration: underline;">5</span>450       <span style="text-decoration: underline;">6</span>000       <span style="text-decoration: underline;">6</span>690       <span style="text-decoration: underline;">6</span>620       <span style="text-decoration: underline;">6</span>580       <span style="text-decoration: underline;">6</span>520</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> M750  1990-09-01  <span style="text-decoration: underline;">6</span>480       <span style="text-decoration: underline;">5</span>450       <span style="text-decoration: underline;">6</span>000       <span style="text-decoration: underline;">6</span>690       <span style="text-decoration: underline;">6</span>620       <span style="text-decoration: underline;">6</span>580</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> M750  1990-10-01  <span style="text-decoration: underline;">6</span>820       <span style="text-decoration: underline;">6</span>480       <span style="text-decoration: underline;">5</span>450       <span style="text-decoration: underline;">6</span>000       <span style="text-decoration: underline;">6</span>690       <span style="text-decoration: underline;">6</span>620</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 320 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 19 more variables: value_lag6 &lt;dbl&gt;, value_lag7 &lt;dbl&gt;, value_lag8 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   value_lag9 &lt;dbl&gt;, value_lag10 &lt;dbl&gt;, value_lag11 &lt;dbl&gt;, value_lag12 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   value_lag13 &lt;dbl&gt;, value_lag14 &lt;dbl&gt;, value_lag15 &lt;dbl&gt;, value_lag16 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   value_lag17 &lt;dbl&gt;, value_lag18 &lt;dbl&gt;, value_lag19 &lt;dbl&gt;, value_lag20 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   value_lag21 &lt;dbl&gt;, value_lag22 &lt;dbl&gt;, value_lag23 &lt;dbl&gt;, value_lag24 &lt;dbl&gt;</span></span></span></code></pre>
<p>We divide the data set into training dataset and future dataset:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">train_data</span> <span class="op">&lt;-</span> <span class="va">m750_lagged</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html" class="external-link">drop_na</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">future_data</span> <span class="op">&lt;-</span> <span class="va">m750_lagged</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Next, we are going to create two models that we will then join into
an ensemble.</p>
<ol style="list-style-type: decimal">
<li>The first model is a Linear Regression model</li>
<li>The second model is a MARS model</li>
</ol>
<p>In a real scenario, we would typically do a pre-selection work where
we would analyze more models and keep those with better performance to
make the ensemble.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_fit_lm</span> <span class="op">&lt;-</span> <span class="fu">linear_reg</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">set_engine</span><span class="op">(</span><span class="st">"lm"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fit</span><span class="op">(</span><span class="va">value</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">train_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">id</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model_fit_mars</span> <span class="op">&lt;-</span> <span class="fu">mars</span><span class="op">(</span><span class="st">"regression"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">set_engine</span><span class="op">(</span><span class="st">"earth"</span>, endspan <span class="op">=</span> <span class="fl">24</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fit</span><span class="op">(</span><span class="va">value</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">train_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">id</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The next step is to create an ensemble of type mean (in which the
predictions of the two models will be averaged) and right after that we
use the <code><a href="https://business-science.github.io/modeltime/reference/recursive.html" class="external-link">recursive()</a></code> function to create the recursive
model.</p>
<ul>
<li>The <code><a href="https://business-science.github.io/modeltime/reference/recursive.html" class="external-link">recursive()</a></code> function tells the ensemble to use
recursion during the prediction process</li>
<li>The recursive model uses the <strong><em>Transformer
Function</em></strong> and <code>train_tail</code> to generate
transformations (e.g. lags) during the prediction process</li>
</ul>
<p>You can consult all the information of the function by typing in the
console <code><a href="https://business-science.github.io/modeltime/reference/recursive.html" class="external-link">?modeltime::recursive</a></code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">recursive_ensemble</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://business-science.github.io/modeltime/reference/modeltime_table.html" class="external-link">modeltime_table</a></span><span class="op">(</span></span>
<span>    <span class="va">model_fit_lm</span>,</span>
<span>    <span class="va">model_fit_mars</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/ensemble_average.html">ensemble_average</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"mean"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://business-science.github.io/modeltime/reference/recursive.html" class="external-link">recursive</a></span><span class="op">(</span></span>
<span>        transform  <span class="op">=</span> <span class="va">lag_transformer</span>,</span>
<span>        train_tail <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">train_data</span>, <span class="va">FORECAST_HORIZON</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="va">recursive_ensemble</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Recursive [modeltime ensemble]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Modeltime Ensemble ───────────────────────────────────────────</span></span>
<span><span class="co">#&gt; Ensemble of 2 Models (MEAN) </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # Modeltime Table</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 3</span></span></span>
<span><span class="co">#&gt;   .model_id .model   .model_desc</span></span>
<span><span class="co">#&gt;       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>         1 <span style="color: #949494;">&lt;fit[+]&gt;</span> LM         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>         2 <span style="color: #949494;">&lt;fit[+]&gt;</span> EARTH</span></span></code></pre>
<p>Next, we add the recursive ensemble to the modeltime table, which
organizes one or more models prior to forecasting.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://business-science.github.io/modeltime/reference/modeltime_table.html" class="external-link">modeltime_table</a></span><span class="op">(</span></span>
<span>    <span class="va">recursive_ensemble</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">model_tbl</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; # Modeltime Table</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">#&gt;   .model_id .model .model_desc                        </span></span>
<span><span class="co">#&gt;       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>         1 <span style="color: #949494;">&lt;&gt;</span>     RECURSIVE ENSEMBLE (MEAN): 2 MODELS</span></span></code></pre>
<p>Finally, we predict over our dataset and visualize the
predictions:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_tbl</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://business-science.github.io/modeltime/reference/modeltime_forecast.html" class="external-link">modeltime_forecast</a></span><span class="op">(</span></span>
<span>        new_data    <span class="op">=</span> <span class="va">future_data</span>,</span>
<span>        actual_data <span class="op">=</span> <span class="va">m750</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://business-science.github.io/modeltime/reference/plot_modeltime_forecast.html" class="external-link">plot_modeltime_forecast</a></span><span class="op">(</span></span>
<span>        .interactive        <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>        .conf_interval_show <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    <span class="op">)</span></span></code></pre></div>
<p><img src="recursive-ensembles_files/figure-html/unnamed-chunk-10-1.png" width="95%" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="panel-ensemble-recursive-example">Panel Ensemble Recursive Example<a class="anchor" aria-label="anchor" href="#panel-ensemble-recursive-example"></a>
</h2>
<blockquote>
<p>Use panel ensembles to batch forecast multimple time series</p>
</blockquote>
<p>This is a more complex extension of the previous example for
forecasting multiple time series in batches. We’ll showcase a Weighted
Ensemble with XGBoost and GLMNET.</p>
<p>First, we select a forecast horizon of 24 days and extend the data
frame with the function <code><a href="https://rdrr.io/pkg/timetk/man/future_frame.html" class="external-link">future_frame()</a></code>. We do this to
create a future dataset, which we can distinguish because its values
will be NA.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">FORECAST_HORIZON</span> <span class="op">&lt;-</span> <span class="fl">24</span></span>
<span></span>
<span><span class="va">m4_extended</span> <span class="op">&lt;-</span> <span class="va">m4_monthly</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/timetk/man/future_frame.html" class="external-link">future_frame</a></span><span class="op">(</span></span>
<span>        .length_out <span class="op">=</span> <span class="va">FORECAST_HORIZON</span>,</span>
<span>        .bind_data  <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Then we create a <strong><em>Transformer Function</em></strong> that
will be in charge of generating the lags for each time series up to each
forecasting horizon. Note that this time we use <strong>grouped
lags</strong> to generate lags by group. This is important when we have
multiple time series. Make sure to ungroup after the lagging
process.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lag_transformer_grouped</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/timetk/man/tk_augment_lags.html" class="external-link">tk_augment_lags</a></span><span class="op">(</span><span class="va">value</span>, .lags <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">FORECAST_HORIZON</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Then, we apply the function and divide the data into training and
future set:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m4_lags</span> <span class="op">&lt;-</span> <span class="va">m4_extended</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">lag_transformer_grouped</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">m4_lags</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1,670 × 27</span></span></span>
<span><span class="co">#&gt;    id    date       value value_lag1 value_lag2 value_lag3 value_lag4 value_lag5</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> M1    1976-06-01  <span style="text-decoration: underline;">8</span>000         <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> M1    1976-07-01  <span style="text-decoration: underline;">8</span>350       <span style="text-decoration: underline;">8</span>000         <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> M1    1976-08-01  <span style="text-decoration: underline;">8</span>570       <span style="text-decoration: underline;">8</span>350       <span style="text-decoration: underline;">8</span>000         <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> M1    1976-09-01  <span style="text-decoration: underline;">7</span>700       <span style="text-decoration: underline;">8</span>570       <span style="text-decoration: underline;">8</span>350       <span style="text-decoration: underline;">8</span>000         <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> M1    1976-10-01  <span style="text-decoration: underline;">7</span>080       <span style="text-decoration: underline;">7</span>700       <span style="text-decoration: underline;">8</span>570       <span style="text-decoration: underline;">8</span>350       <span style="text-decoration: underline;">8</span>000         <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> M1    1976-11-01  <span style="text-decoration: underline;">6</span>520       <span style="text-decoration: underline;">7</span>080       <span style="text-decoration: underline;">7</span>700       <span style="text-decoration: underline;">8</span>570       <span style="text-decoration: underline;">8</span>350       <span style="text-decoration: underline;">8</span>000</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> M1    1976-12-01  <span style="text-decoration: underline;">6</span>070       <span style="text-decoration: underline;">6</span>520       <span style="text-decoration: underline;">7</span>080       <span style="text-decoration: underline;">7</span>700       <span style="text-decoration: underline;">8</span>570       <span style="text-decoration: underline;">8</span>350</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> M1    1977-01-01  <span style="text-decoration: underline;">6</span>650       <span style="text-decoration: underline;">6</span>070       <span style="text-decoration: underline;">6</span>520       <span style="text-decoration: underline;">7</span>080       <span style="text-decoration: underline;">7</span>700       <span style="text-decoration: underline;">8</span>570</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> M1    1977-02-01  <span style="text-decoration: underline;">6</span>830       <span style="text-decoration: underline;">6</span>650       <span style="text-decoration: underline;">6</span>070       <span style="text-decoration: underline;">6</span>520       <span style="text-decoration: underline;">7</span>080       <span style="text-decoration: underline;">7</span>700</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> M1    1977-03-01  <span style="text-decoration: underline;">5</span>710       <span style="text-decoration: underline;">6</span>830       <span style="text-decoration: underline;">6</span>650       <span style="text-decoration: underline;">6</span>070       <span style="text-decoration: underline;">6</span>520       <span style="text-decoration: underline;">7</span>080</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1,660 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 19 more variables: value_lag6 &lt;dbl&gt;, value_lag7 &lt;dbl&gt;, value_lag8 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   value_lag9 &lt;dbl&gt;, value_lag10 &lt;dbl&gt;, value_lag11 &lt;dbl&gt;, value_lag12 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   value_lag13 &lt;dbl&gt;, value_lag14 &lt;dbl&gt;, value_lag15 &lt;dbl&gt;, value_lag16 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   value_lag17 &lt;dbl&gt;, value_lag18 &lt;dbl&gt;, value_lag19 &lt;dbl&gt;, value_lag20 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   value_lag21 &lt;dbl&gt;, value_lag22 &lt;dbl&gt;, value_lag23 &lt;dbl&gt;, value_lag24 &lt;dbl&gt;</span></span></span></code></pre>
<p>We split into training data and future data.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">train_data</span> <span class="op">&lt;-</span> <span class="va">m4_lags</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html" class="external-link">drop_na</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">future_data</span> <span class="op">&lt;-</span> <span class="va">m4_lags</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Next, we are going to create two models that we will then join into
an ensemble.</p>
<ol style="list-style-type: decimal">
<li><p><strong>The first model is an Elastic Net (GLMNET)
model:</strong> An elastic net applies is an improved version of linear
regression that applies a penalty to the lagged regressors preventing
bad lags from dominating the results. This can show an improvement
versus a standard Linear Regression.</p></li>
<li><p><strong>The second model is an XGBOOST model:</strong> An xgboost
model is a tree-based algorithm that is very different in how it models
vs a linear model. It’s much better for non-linear data
(e.g. seasonality).</p></li>
</ol>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_fit_glmnet</span> <span class="op">&lt;-</span> <span class="fu">linear_reg</span><span class="op">(</span>penalty <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">set_engine</span><span class="op">(</span><span class="st">"glmnet"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fit</span><span class="op">(</span><span class="va">value</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">train_data</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model_fit_xgboost</span> <span class="op">&lt;-</span> <span class="fu">boost_tree</span><span class="op">(</span><span class="st">"regression"</span>, learn_rate <span class="op">=</span> <span class="fl">0.35</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">set_engine</span><span class="op">(</span><span class="st">"xgboost"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fit</span><span class="op">(</span><span class="va">value</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">train_data</span><span class="op">)</span></span></code></pre></div>
<p>The next step is to create an ensemble. We’ll use a Weighted Ensemble
(<code><a href="../reference/ensemble_weighted.html">ensemble_weighted()</a></code>) with a 60/40 loading. Right after
that we use the <code><a href="https://business-science.github.io/modeltime/reference/recursive.html" class="external-link">recursive()</a></code> function to create the
recursive model. Unlike the previous example:</p>
<ul>
<li>We have to pass to the recursive function the argument
<code>id</code> specifying ID’s for each time series group</li>
<li>We have to use the <code><a href="https://business-science.github.io/modeltime/reference/panel_tail.html" class="external-link">panel_tail()</a></code> function to create the
train_tail by group.</li>
</ul>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">recursive_ensemble_panel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://business-science.github.io/modeltime/reference/modeltime_table.html" class="external-link">modeltime_table</a></span><span class="op">(</span></span>
<span>    <span class="va">model_fit_glmnet</span>,</span>
<span>    <span class="va">model_fit_xgboost</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/ensemble_weighted.html">ensemble_weighted</a></span><span class="op">(</span>loadings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://business-science.github.io/modeltime/reference/recursive.html" class="external-link">recursive</a></span><span class="op">(</span></span>
<span>        transform  <span class="op">=</span> <span class="va">lag_transformer_grouped</span>,</span>
<span>        train_tail <span class="op">=</span> <span class="fu"><a href="https://business-science.github.io/modeltime/reference/panel_tail.html" class="external-link">panel_tail</a></span><span class="op">(</span><span class="va">train_data</span>, <span class="va">id</span>, <span class="va">FORECAST_HORIZON</span><span class="op">)</span>,</span>
<span>        id         <span class="op">=</span> <span class="st">"id"</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="va">recursive_ensemble_panel</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Recursive [modeltime ensemble]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Modeltime Ensemble ───────────────────────────────────────────</span></span>
<span><span class="co">#&gt; Ensemble of 2 Models (WEIGHTED) </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # Modeltime Table</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 4</span></span></span>
<span><span class="co">#&gt;   .model_id .model   .model_desc .loadings</span></span>
<span><span class="co">#&gt;       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>         1 <span style="color: #949494;">&lt;fit[+]&gt;</span> GLMNET            0.4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>         2 <span style="color: #949494;">&lt;fit[+]&gt;</span> XGBOOST           0.6</span></span></code></pre>
<p>Next, we add the recursive ensemble to the modeltime table, which
organizes one or more models prior to forecasting.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://business-science.github.io/modeltime/reference/modeltime_table.html" class="external-link">modeltime_table</a></span><span class="op">(</span></span>
<span>    <span class="va">recursive_ensemble_panel</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">model_tbl</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; # Modeltime Table</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">#&gt;   .model_id .model .model_desc                            </span></span>
<span><span class="co">#&gt;       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>         1 <span style="color: #949494;">&lt;&gt;</span>     RECURSIVE ENSEMBLE (WEIGHTED): 2 MODELS</span></span></code></pre>
<p>Finally, we forecast over our dataset and visualize the forecast.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_tbl</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://business-science.github.io/modeltime/reference/modeltime_forecast.html" class="external-link">modeltime_forecast</a></span><span class="op">(</span></span>
<span>        new_data    <span class="op">=</span> <span class="va">future_data</span>,</span>
<span>        actual_data <span class="op">=</span> <span class="va">m4_lags</span>,</span>
<span>        keep_data   <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://business-science.github.io/modeltime/reference/plot_modeltime_forecast.html" class="external-link">plot_modeltime_forecast</a></span><span class="op">(</span></span>
<span>        .interactive        <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>        .conf_interval_show <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>        .facet_ncol         <span class="op">=</span> <span class="fl">2</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<p><img src="recursive-ensembles_files/figure-html/unnamed-chunk-18-1.png" width="95%" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>Recursive modeling can be applied to ensembles. But, this is just a
small portion of everything that can be done…. If you want to get all
the details, read on!</p>
<div class="section level3">
<h3 id="take-the-high-performance-forecasting-course">Take the High-Performance Forecasting Course<a class="anchor" aria-label="anchor" href="#take-the-high-performance-forecasting-course"></a>
</h3>
<blockquote>
<p>Become the forecasting expert for your organization</p>
</blockquote>
<p><a href="https://university.business-science.io/p/ds4b-203-r-high-performance-time-series-forecasting/" target="_blank" class="external-link"><img src="https://www.filepicker.io/api/file/bKyqVAi5Qi64sS05QYLk" alt="High-Performance Time Series Forecasting Course" width="100%" style="box-shadow: 0 0 5px 2px rgba(0, 0, 0, .5);"></a></p>
<p><a href="https://university.business-science.io/p/ds4b-203-r-high-performance-time-series-forecasting/" class="external-link"><em>High-Performance
Time Series Course</em></a></p>
<div class="section level4">
<h4 id="time-series-is-changing">Time Series is Changing<a class="anchor" aria-label="anchor" href="#time-series-is-changing"></a>
</h4>
<p>Time series is changing. <strong>Businesses now need 10,000+ time
series forecasts every day.</strong> This is what I call a
<em>High-Performance Time Series Forecasting System (HPTSF)</em> -
Accurate, Robust, and Scalable Forecasting.</p>
<p><strong>High-Performance Forecasting Systems will save companies by
improving accuracy and scalability.</strong> Imagine what will happen to
your career if you can provide your organization a “High-Performance
Time Series Forecasting System” (HPTSF System).</p>
</div>
<div class="section level4">
<h4 id="how-to-learn-high-performance-time-series-forecasting">How to Learn High-Performance Time Series Forecasting<a class="anchor" aria-label="anchor" href="#how-to-learn-high-performance-time-series-forecasting"></a>
</h4>
<p>I teach how to build a HPTFS System in my <a href="https://university.business-science.io/p/ds4b-203-r-high-performance-time-series-forecasting" class="external-link"><strong>High-Performance
Time Series Forecasting Course</strong></a>. You will learn:</p>
<ul>
<li>
<strong>Time Series Machine Learning</strong> (cutting-edge) with
<code>Modeltime</code> - 30+ Models (Prophet, ARIMA, XGBoost, Random
Forest, &amp; many more)</li>
<li>
<strong>Deep Learning</strong> with <code>GluonTS</code>
(Competition Winners)</li>
<li>
<strong>Time Series Preprocessing</strong>, Noise Reduction, &amp;
Anomaly Detection</li>
<li>
<strong>Feature engineering</strong> using lagged variables &amp;
external regressors</li>
<li><strong>Hyperparameter Tuning</strong></li>
<li><strong>Time series cross-validation</strong></li>
<li>
<strong>Ensembling</strong> Multiple Machine Learning &amp;
Univariate Modeling Techniques (Competition Winner)</li>
<li>
<strong>Scalable Forecasting</strong> - Forecast 1000+ time series
in parallel</li>
<li>and more.</li>
</ul>
<p class="text-center" style="font-size:24px;">
</p>
<p>Become the Time Series Expert for your organization.</p>

<p><br></p>
<p class="text-center" style="font-size:30px;">
</p>
<p><a href="https://university.business-science.io/p/ds4b-203-r-high-performance-time-series-forecasting" class="external-link">Take
the High-Performance Time Series Forecasting Course</a></p>

</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Matt Dancho.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
